#!/bin/bash
## Static vars
SCRIPTNAME="automount"

## Call to libgoran
. /bin/libgoran

## Code
vflag="true"
SSD_UUID="842750cc-1a91-4d41-bc76-5ac415f92e4c"
declare -i nUSB=0
declare -i nDisks

getPartitionName()
{
    readlink -f "/dev/disk/by-uuid/$1"
}

while true; do
    disks=$(ls /dev/disk/by-uuid)
    nDisks=$(echo "$disks" | wc -w)
    if [[ $nDisks -gt 2 ]]; then
        for disk in ${disks[@]}; do

            if [[ $disk != "3E50-902A" ]] && [[ $disk != "378383c9-0612-4c82-9c07-8c34d15253ba" ]]; then

                if [[ $disk == $SSD_UUID ]] && ! ls "/rpi/roms" > /dev/null 2>&1; then
                    msgWarn "Folder /rpi/roms is not accesible!"
                    touch "/tmp/crossgame.ready"
                    if mount $(getPartitionName $disk) "/rpi" > /dev/null; then
                        msgOk "SSD partition mounted into /rpi!"
                    else
                        msgError "Cannot mount SSD partition"
                    fi
                fi

            fi

        done
    fi
    sleep 5
done
